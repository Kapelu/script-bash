#!/bin/bash
clear
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
echo "โ Autor: Daniel Calderon - Kapelu                โ"
echo "โ Versiรณn: 2.0                                   โ"
echo "โ Fecha: 16/10/2025                              โ"
echo "โ WebSite: https://danielcalderon.vercel.app/    โ"
echo "โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ"
# ========================
# Buscar carpeta Github
# ========================
BASE_DIR_NAME="Github"
CURRENT_DIR="$(pwd)"

while [[ "$CURRENT_DIR" != "/" ]]; do
  if [[ -d "$CURRENT_DIR/$BASE_DIR_NAME" ]]; then
    BASE_DIR="$CURRENT_DIR/$BASE_DIR_NAME"
    break
  fi
  CURRENT_DIR="$(dirname "$CURRENT_DIR")"
done

if [[ -z "$BASE_DIR" ]]; then
  echo
  echo
  echo
  echo "โ No se encontrรณ la carpeta '$BASE_DIR_NAME'"
  exit 1
fi
echo
echo
echo
echo "๐ Escaneando: $BASE_DIR"
echo
echo
echo
sleep 5

# ========================
# Archvos y carpetas a elimnar
# ========================
TARGET_ITEMS=(
  ".next"
  "node_modules"
  ".container"
  ".env.local"
  ".DS_Store"
  "npm-debug.log"
)

# ========================
# Busca TARGET_ITEMS en BASE_DIR
# ========================
NAME_ARGS=()
for item in "${TARGET_ITEMS[@]}"; do
  NAME_ARGS+=( -name "$item" -o )
done
unset 'NAME_ARGS[-1]'

mapfile -t MATCHES < <(
  find "$BASE_DIR" \
    \( -type d -o -type f \) \
    \( "${NAME_ARGS[@]}" \) \
    -prune
)

TOTAL=${#MATCHES[@]}

if [[ "$TOTAL" -eq 0 ]]; then
  clear
  echo
  echo
  echo
  echo "โ No se encontraron archivos ni carpetas para borrar"
  echo
  sleep 5
  clear
  exit 0
fi

# ========================
# Listado de elementos a eliminar
# ========================
echo
echo
echo
echo "โ๏ธ Se eliminarรกn los siguientes $TOTAL elementos:"
echo "---------------------------------------------"
for item in "${MATCHES[@]}"; do
  echo "  โข $item"
done
echo "---------------------------------------------"
echo

# ========================
# Confirmaciรณn FINAL
# ========================
read -p "๐ฅ ยฟConfirmรกs el borrado TOTAL? (y/N): " CONFIRM
echo
echo
echo

if [[ ! "$CONFIRM" =~ ^[yY]$ ]]; then
  echo "โ Operaciรณn cancelada"
  exit 0
fi

# ========================
# Borrado
# ========================
echo
echo
echo
echo
echo "๐งจ Eliminando..."
echo

count=0
for item in "${MATCHES[@]}"; do
  rm -rf "$item"
  ((count++))

  percent=$((count * 100 / TOTAL))
  filled=$((percent / 2))
  empty=$((50 - filled))

  printf "\r["
  printf "%0.s#" $(seq 1 "$filled")
  printf "%0.s-" $(seq 1 "$empty")
  printf "] %d%% (%d/%d)" "$percent" "$count" "$TOTAL"
done

echo
echo
echo "โ Limpieza completa. $TOTAL elementos eliminados."
echo
echo
echo
sleep 3